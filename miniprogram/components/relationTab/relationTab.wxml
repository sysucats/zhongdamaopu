<!-- çŒ«é™…å…³ç³»ç®¡ç† -->
<view class="relation-section" wx:if="{{selectedCat}}">
  <!-- å…³ç³»åˆ—è¡¨ -->
  <view class="relation-list" wx:if="{{cat && cat.relations && cat.relations.length > 0}}">
    <view class="relation-item" wx:for="{{cat.relations}}" wx:key="index">
      <!-- åºå·æ ‡ç­¾ -->
      <view class="relation-index">#{{index+1}}</view>
      
      <view class="relation-content">
        <!-- å…³ç³»ç±»å‹ -->
        <view class="relation-type" hover-class="button-hover" bindtap="bindSearch" data-type="relation" data-index="{{index}}">
          {{item.type || 'é€‰æ‹©å…³ç³»'}}
        </view>
        
        <!-- ç›¸å…³çŒ«å’ª -->
        <view class="relation-cat" hover-class="button-hover" bindtap="bindSearch" data-type="cat" data-index="{{index}}">
          <image mode="aspectFill" class="relation-cat-avatar" src="{{item.cat.avatar ? item.cat.avatar.photo_compressed || item.cat.avatar.photo_id : ''}}"></image>
          <view class="relation-cat-info">
            <view class="relation-cat-name">{{item.cat.name || 'ç‚¹å‡»é€‰æ‹©çŒ«çŒ«'}}</view>
            <view class="relation-cat-location" wx:if="{{item.cat.campus}}">{{item.cat.campus}} {{item.cat.area}}</view>
          </view>
        </view>
      
        <view class="relation-delete-btn" hover-class="button-hover" bindtap='bindRelationTap' data-index='{{index}}' data-type="delete">åˆ é™¤</view>
      </view>
      
      <!-- ä¸Šä¸‹ç§» -->
      <view class="move-action up {{index <= 0? 'disabled': ''}}" hover-class="button-hover" bindtap='bindRelationTap' data-index='{{index}}' data-type="up"><text class="iconfont icon-arrow-up"></text></view>
      <view class="move-action down {{index >= cat.relations.length-1? 'disabled': ''}}" hover-class="button-hover" bindtap='bindRelationTap' data-index='{{index}}' data-type="down"><text class="iconfont icon-arrow-down"></text></view>
    </view>
  </view>
  
  <view class="empty-tip" wx:elif="{{cat && cat._id}}">
    <view class="empty-icon">ğŸ±</view>
    <view>æš‚æ— å…³ç³»è®°å½•ï¼Œç‚¹å‡»å³ä¸‹è§’æ·»åŠ </view>
  </view>
</view>

<!-- æœç´¢ -->
<searchCat show="{{showSearchCat}}" bind:select="searchSelectCat" bind:close="hideSearch"></searchCat>

<popup id='search' show="{{showSearchType}}" bind:close="hideSearch">
  <view class="popup-container">
    <view class="popup-header">
      <text>é€‰æ‹©å…³ç³»ç±»å‹</text>
    </view>
    <view class='search-input'>
      <view class='input-icon'>
        <image class="search-icon" mode='aspectFit' src="/pages/public/images/card/card/cat.png"></image>
      </view>
      <input class='input-field' placeholder='è¾“å…¥å…³ç³»åï¼Œå¦‚ä¸å­˜åœ¨åˆ™è‡ªåŠ¨æ–°å»º' placeholder-class='placeholder' focus="{{focusSearchType}}" maxlength='10' confirm-type='done' bindconfirm='saveNewRelationType' value="{{relation_name}}"></input>
    </view>
    <scroll-view class="search-results" scroll-y="1">
      <view class="relation-type-item" wx:for="{{relation_types}}" wx:key="item">
        <view class="relation-type-name">{{item}}</view>
        <view class="relation-type-actions">
          <view class="type-action select" hover-class="button-hover" bindtap='selectRelationType' data-index='{{index}}'>é€‰æ‹©</view>
          <view class="type-action delete" hover-class="button-hover" bindtap='deleteRelationType' data-index='{{index}}'>åˆ é™¤</view>
        </view>
      </view>
      <view wx:if="{{!relation_types.length}}" class="search-empty">æš‚æ— å…³ç³»ç±»å‹</view>
    </scroll-view>
  </view>
</popup> 